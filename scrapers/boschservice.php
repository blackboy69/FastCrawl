<?
include_once "config.inc";


class boschservice extends baseScrape
{
   public static $_this=null;

	public function runLoader()
   {
		//$this->noProxy=false;
		//$this->proxy='localhost:9666';

		// R::freeze();
		$type = get_class();		
//		db::query("DELETE FROM load_queue  where type='$type'");
		//db::query("UPDATE raw_data set parsed = 0 where type='$type' ");

		$this->threads=1;

		$this->debug=false;

		//$this->loadUrlsByZip("http://www.boschservice-usa.com/_en/_us/conso/salons/salon_result.aspx?zipcode=%ZIP%&SearchFilter=&ispostback=1",0);

		//$this->loadUrlsByCity("http://www.boschservice.com/Pages/AutomotiveServiceLocatorMapResults.aspx?Zip=%ZIP%&Distance=10&State=Select&City=&VehicleMake=&SpecialOffers=false&LocatorId=13");


   
      $type = self::type();

      $webRequests = array();
/*		
		$html = $this->get("http://www.boschcarservice.us/Pages/ForYourVehicle.aspx");

		$xpath = new Xpath($html);
		$forms = $xpath->getForm();
		$form = $forms[0];
		$data = array_merge($xpath->loadViewState());
*/
    //  $result = mysql_query("SELECT CITY,STATE FROM geo.US_CITIES  order by pop desc  LIMIT 1000");
      $result = mysql_query("SELECT distinct ZIP, CITY, STATE  FROM geo.locations order by pop desc  LIMIT 1000");

	  $found = false;
      while ($r = mysql_fetch_row($result))
      {
			$zip = urlencode($r[0]);
			$city = urlencode($r[1]);
			$state = urlencode($r[2]);
	
			foreach(array('rbAutomotiveServiceCenter','rbDieselServiceCenter','rbDieselServiceDealer','rbHeavyDutyElectricCenter') as $t)
			{
				$url = "http://www.boschcarservice.us/Pages/ForYourVehicle.aspx?$zip,$t";

// post using the browser to get an updated viewstate hunk
$post = '__SPSCEditMenu=true&MSOWebPartPage_PostbackSource=&MSOTlPn_SelectedWpId=&MSOTlPn_View=0&MSOTlPn_ShowSettings=False&MSOGallery_SelectedLibrary=&MSOGallery_FilterString=&MSOTlPn_Button=none&__EVENTTARGET=&__EVENTARGUMENT=&__REQUESTDIGEST=0x28908A363FB406594AFD09375F0DDA407DEE35304ADBC395939E9C94AED480F674D2CA81B6C0384EF4FC66D4617474EC13BC7C9AF37D07777719436E60396D9B%2C21+Nov+2013+06%3A12%3A15+-0000&MSOAuthoringConsole_FormContext=&MSOAC_EditDuringWorkflow=&MSOSPWebPartManager_DisplayModeName=Browse&MSOWebPartPage_Shared=&MSOLayout_LayoutChanges=&MSOLayout_InDesignMode=&MSOSPWebPartManager_OldDisplayModeName=Browse&MSOSPWebPartManager_StartWebPartEditingName=false&__VIEWSTATE=%2FwEPDwUBMA9kFgJmD2QWBAICD2QWBAIFD2QWAmYPFgIeBFRleHQFEEZvciBZb3VyIFZlaGljbGVkAhUPFgIfAAWCBDxtZXRhIHByb3BlcnR5PSJvZzp0aXRsZSIgY29udGVudD0iRm9yIFlvdXIgVmVoaWNsZSIvPjxtZXRhIHByb3BlcnR5PSJvZzp0eXBlIiBjb250ZW50PSJ3ZWJzaXRlIi8%2BPG1ldGEgcHJvcGVydHk9Im9nOnVybCIgY29udGVudD0iaHR0cDovL3d3dy5ib3NjaGNhcnNlcnZpY2UudXMvUGFnZXMvRm9yWW91clZlaGljbGUuYXNweCIvPjxtZXRhIHByb3BlcnR5PSJvZzppbWFnZSIgY29udGVudD0iaHR0cDovL3d3dy5ib3NjaGNhcnNlcnZpY2UudXMvU3R5bGUlMjBMaWJyYXJ5L0JDUy9JbWFnZXMvQkNTU2hpZWxkLnBuZyIvPjxtZXRhIHByb3BlcnR5PSJvZzpzaXRlX25hbWUiIGNvbnRlbnQ9IkJvc2NoIENhciBTZXJ2aWNlIi8%2BPG1ldGEgcHJvcGVydHk9Im9nOmRlc2NyaXB0aW9uIiBjb250ZW50PSJGaW5kIGEgbG9jYWwgQm9zY2ggQ2FyIFNlcnZpY2UgY2VudGVyIHRvIGhhdmUgeW91ciB2ZWhpY2xlIG1haW50YWluZWQgb3IgcmVwYWlyZWQsIGluIHRoZSBVbml0ZWQgU3RhdGVzIG9yIENhbmFkYS4iLz5kAgQPZBYOAgUPZBYCAgEPFgIeB1Zpc2libGVoFgJmD2QWBAICD2QWBgIBDxYCHwFoZAIDDxYCHwFoZAIFDxYCHwFoZAIDDw8WAh4JQWNjZXNzS2V5BQEvZGQCBw9kFgICBQ9kFgICAg8PFgQfAAUHU2lnbiBJbh8BZxYCHgVzdHlsZQUOZGlzcGxheTpibG9jaztkAgkPZBYCAgMPZBYCAgEPDxYCHwFnZBYEAgEPDxYCHwFoZBYcAgEPDxYCHwFoZGQCAw8WAh8BaGQCBQ8PFgIfAWhkZAIHDxYCHwFoZAIJDw8WAh8BaGRkAgsPDxYCHwFoZGQCDQ8PFgIfAWhkZAIPDw8WBB4HRW5hYmxlZGgfAWhkZAIRDw8WAh8BaGRkAhMPDxYEHwRoHwFoZGQCFQ8PFgIfAWhkZAIXDxYCHwFoZAIZDxYCHwFoZAIbDw8WAh8BZ2RkAgMPDxYCHwFnZBYGAgEPDxYCHwFnZGQCAw8PFgYeGHBlcnNpc3RlZEVycm9yQWN0aW9uVHJlZWQeG3BlcnNpc3RlZEVycm9yQWN0aW9uVHJlZUlkc2QfAWdkZAIFDw8WAh8BZ2RkAhEPZBYEAgEPFgIeCWlubmVyaHRtbAVCQm9zY2ggQ2FyIFNlcnZpY2UgLSBRdWFsaXR5IENhciBhbmQgTGlnaHQgVHJ1Y2sgU2VydmljZSBhbmQgUmVwYWlyZAIDD2QWAmYPFgIfAAXKIDx1bD48bGkgY2xhc3M9Im5vU3ViIiBpZD0iaG9tZSI%2BPGEgaHJlZj0iaHR0cDovL3d3dy5ib3NjaGNhcnNlcnZpY2UudXMvIj5PdmVydmlldzwvYT48L2xpPjxsaSBjbGFzcz0ibm9TdWIiPjxhIGhyZWY9Imh0dHA6Ly93d3cuYm9zY2hjYXJzZXJ2aWNlLnVzL1BhZ2VzL1doeUJvc2NoQ2FyU2VydmljZS5hc3B4Ij5XaHkgQm9zY2ggQ2FyIFNlcnZpY2U%2FPC9hPjwvbGk%2BPGxpIGNsYXNzPSJhY3RpdmUiPjxhIGhyZWY9Imh0dHA6Ly93d3cuYm9zY2hjYXJzZXJ2aWNlLnVzL0ZpbmRTdmNDZW50ZXIvUGFnZXMvRmluZGluZ2FTZXJ2aWNlQ2VudGVyLmFzcHgiPkZpbmQgYSBTZXJ2aWNlIENlbnRlcjwvYT48dWw%2BPGxpPjxhIGNsYXNzPSJhcnJvdyBqc0xpbmsiIGhyZWY9Imh0dHA6Ly93d3cuYm9zY2hjYXJzZXJ2aWNlLnVzL1BhZ2VzL0ZvcllvdXJWZWhpY2xlLmFzcHgiPjxzcGFuIGNsYXNzPSJicmQiPjxzcGFuIGNsYXNzPSJicmRSaWdodCI%2BPGltZyBib3JkZXI9Im5vbmUiIGFsdD0iIiBzcmM9Ii9TdHlsZSUyMExpYnJhcnkvQkNTL0ltYWdlcy9hcnJvd19ncmV5Rmx5b3V0LmdpZiIgLz48c3BhbiBjbGFzcz0iZm9MaW5rIj5Gb3IgWW91ciBWZWhpY2xlPC9zcGFuPjwvc3Bhbj48L3NwYW4%2BPHNwYW4gY2xhc3M9ImJyZEVuZCI%2BPHNwYW4gY2xhc3M9ImJyZFJFbmQiPjwvc3Bhbj48L3NwYW4%2BPC9hPjwvbGk%2BPGxpPjxhIGNsYXNzPSJhcnJvdyBqc0xpbmsiIGhyZWY9Imh0dHA6Ly93d3cuYm9zY2hjYXJzZXJ2aWNlLnVzL1BhZ2VzL0Jvc2NoSm9icy5hc3B4Ij48c3BhbiBjbGFzcz0iYnJkIj48c3BhbiBjbGFzcz0iYnJkUmlnaHQiPjxpbWcgYm9yZGVyPSJub25lIiBhbHQ9IiIgc3JjPSIvU3R5bGUlMjBMaWJyYXJ5L0JDUy9JbWFnZXMvYXJyb3dfZ3JleUZseW91dC5naWYiIC8%2BPHNwYW4gY2xhc3M9ImZvTGluayI%2BRm9yIFlvdXIgQ2FyZWVyPC9zcGFuPjwvc3Bhbj48L3NwYW4%2BPHNwYW4gY2xhc3M9ImJyZEVuZCI%2BPHNwYW4gY2xhc3M9ImJyZFJFbmQiPjwvc3Bhbj48L3NwYW4%2BPC9hPjwvbGk%2BPC91bD48L2xpPjxsaSBjbGFzcz0iIj48YSBocmVmPSJodHRwOi8vd3d3LmJvc2NoY2Fyc2VydmljZS51cy9QYWdlcy9Cb3NjaFN0b3J5LmFzcHgiPkJvc2NoIFN0b3J5PC9hPjx1bD48bGk%2BPGEgY2xhc3M9ImFycm93IGpzTGluayIgaHJlZj0iaHR0cDovL3d3dy5ib3NjaGNhcnNlcnZpY2UudXMvUGFnZXMvVGhlV29ybGRvZkJvc2NoLmFzcHgiPjxzcGFuIGNsYXNzPSJicmQiPjxzcGFuIGNsYXNzPSJicmRSaWdodCI%2BPGltZyBib3JkZXI9Im5vbmUiIGFsdD0iIiBzcmM9Ii9TdHlsZSUyMExpYnJhcnkvQkNTL0ltYWdlcy9hcnJvd19ncmV5Rmx5b3V0LmdpZiIgLz48c3BhbiBjbGFzcz0iZm9MaW5rIj5UaGUgV29ybGQgT2YgQm9zY2g8L3NwYW4%2BPC9zcGFuPjwvc3Bhbj48c3BhbiBjbGFzcz0iYnJkRW5kIj48c3BhbiBjbGFzcz0iYnJkUkVuZCI%2BPC9zcGFuPjwvc3Bhbj48L2E%2BPC9saT48bGk%2BPGEgY2xhc3M9ImFycm93IGpzTGluayIgaHJlZj0iaHR0cDovL3d3dy5ib3NjaGNhcnNlcnZpY2UudXMvUGFnZXMvU29jaWFsUmVzcG9uc2liaWxpdHkuYXNweCI%2BPHNwYW4gY2xhc3M9ImJyZCI%2BPHNwYW4gY2xhc3M9ImJyZFJpZ2h0Ij48aW1nIGJvcmRlcj0ibm9uZSIgYWx0PSIiIHNyYz0iL1N0eWxlJTIwTGlicmFyeS9CQ1MvSW1hZ2VzL2Fycm93X2dyZXlGbHlvdXQuZ2lmIiAvPjxzcGFuIGNsYXNzPSJmb0xpbmsiPlNvY2lhbCBSZXNwb25zaWJpbGl0eTwvc3Bhbj48L3NwYW4%2BPC9zcGFuPjxzcGFuIGNsYXNzPSJicmRFbmQiPjxzcGFuIGNsYXNzPSJicmRSRW5kIj48L3NwYW4%2BPC9zcGFuPjwvYT48L2xpPjxsaT48YSBjbGFzcz0iYXJyb3cganNMaW5rIiBocmVmPSJodHRwOi8vd3d3LmJvc2NoY2Fyc2VydmljZS51cy9Cb3NjaE5ld3MvUGFnZXMvQm9zY2hTZXJ2aWNlTmV3cy5hc3B4Ij48c3BhbiBjbGFzcz0iYnJkIj48c3BhbiBjbGFzcz0iYnJkUmlnaHQiPjxpbWcgYm9yZGVyPSJub25lIiBhbHQ9IiIgc3JjPSIvU3R5bGUlMjBMaWJyYXJ5L0JDUy9JbWFnZXMvYXJyb3dfZ3JleUZseW91dC5naWYiIC8%2BPHNwYW4gY2xhc3M9ImZvTGluayI%2BTmV3czwvc3Bhbj48L3NwYW4%2BPC9zcGFuPjxzcGFuIGNsYXNzPSJicmRFbmQiPjxzcGFuIGNsYXNzPSJicmRSRW5kIj48L3NwYW4%2BPC9zcGFuPjwvYT48L2xpPjwvdWw%2BPC9saT48bGkgY2xhc3M9IiI%2BPGEgaHJlZj0iaHR0cDovL3d3dy5ib3NjaGNhcnNlcnZpY2UudXMvUGFnZXMvRmVhdHVyZXMuYXNweCI%2BRmVhdHVyZXM8L2E%2BPHVsPjxsaT48YSBjbGFzcz0iYXJyb3cganNMaW5rIiBocmVmPSJodHRwOi8vd3d3LmJvc2NoY2Fyc2VydmljZS51cy9QYWdlcy9Bc2tFeHBlcnQuYXNweCI%2BPHNwYW4gY2xhc3M9ImJyZCI%2BPHNwYW4gY2xhc3M9ImJyZFJpZ2h0Ij48aW1nIGJvcmRlcj0ibm9uZSIgYWx0PSIiIHNyYz0iL1N0eWxlJTIwTGlicmFyeS9CQ1MvSW1hZ2VzL2Fycm93X2dyZXlGbHlvdXQuZ2lmIiAvPjxzcGFuIGNsYXNzPSJmb0xpbmsiPkFzayB0aGUgRXhwZXJ0PC9zcGFuPjwvc3Bhbj48L3NwYW4%2BPHNwYW4gY2xhc3M9ImJyZEVuZCI%2BPHNwYW4gY2xhc3M9ImJyZFJFbmQiPjwvc3Bhbj48L3NwYW4%2BPC9hPjwvbGk%2BPGxpPjxhIGNsYXNzPSJhcnJvdyBqc0xpbmsiIGhyZWY9Imh0dHA6Ly93d3cuYm9zY2hjYXJzZXJ2aWNlLnVzL1BhZ2VzL0Jvc2NoU2VydmljZUNyZWRpdENhcmQuYXNweCI%2BPHNwYW4gY2xhc3M9ImJyZCI%2BPHNwYW4gY2xhc3M9ImJyZFJpZ2h0Ij48aW1nIGJvcmRlcj0ibm9uZSIgYWx0PSIiIHNyYz0iL1N0eWxlJTIwTGlicmFyeS9CQ1MvSW1hZ2VzL2Fycm93X2dyZXlGbHlvdXQuZ2lmIiAvPjxzcGFuIGNsYXNzPSJmb0xpbmsiPkNyZWRpdCBDYXJkPC9zcGFuPjwvc3Bhbj48L3NwYW4%2BPHNwYW4gY2xhc3M9ImJyZEVuZCI%2BPHNwYW4gY2xhc3M9ImJyZFJFbmQiPjwvc3Bhbj48L3NwYW4%2BPC9hPjwvbGk%2BPGxpPjxhIGNsYXNzPSJhcnJvdyBqc0xpbmsiIGhyZWY9Imh0dHA6Ly93d3cuYm9zY2hjYXJzZXJ2aWNlLnVzL1Byb21vdGlvbnMvUGFnZXMvUHJvbW90aW9ucy5hc3B4Ij48c3BhbiBjbGFzcz0iYnJkIj48c3BhbiBjbGFzcz0iYnJkUmlnaHQiPjxpbWcgYm9yZGVyPSJub25lIiBhbHQ9IiIgc3JjPSIvU3R5bGUlMjBMaWJyYXJ5L0JDUy9JbWFnZXMvYXJyb3dfZ3JleUZseW91dC5naWYiIC8%2BPHNwYW4gY2xhc3M9ImZvTGluayI%2BUHJvbW90aW9uczwvc3Bhbj48L3NwYW4%2BPC9zcGFuPjxzcGFuIGNsYXNzPSJicmRFbmQiPjxzcGFuIGNsYXNzPSJicmRSRW5kIj48L3NwYW4%2BPC9zcGFuPjwvYT48L2xpPjxsaT48YSBjbGFzcz0iYXJyb3cganNMaW5rIiBocmVmPSJodHRwOi8vYm9zY2guYXJpbmV0LmNvbS9ib3NjaGxvZ2luLmFzcCIgdGFyZ2V0PSJfYmxhbmsiID48c3BhbiBjbGFzcz0iYnJkIj48c3BhbiBjbGFzcz0iYnJkUmlnaHQiPjxpbWcgYm9yZGVyPSJub25lIiBhbHQ9IiIgc3JjPSIvU3R5bGUlMjBMaWJyYXJ5L0JDUy9JbWFnZXMvYXJyb3dfZ3JleUZseW91dC5naWYiIC8%2BPHNwYW4gY2xhc3M9ImZvTGluayI%2BVERJIE9ubGluZSBQYXJ0cyBDYXRhbG9nPC9zcGFuPjwvc3Bhbj48L3NwYW4%2BPHNwYW4gY2xhc3M9ImJyZEVuZCI%2BPHNwYW4gY2xhc3M9ImJyZFJFbmQiPjwvc3Bhbj48L3NwYW4%2BPC9hPjwvbGk%2BPGxpPjxhIGNsYXNzPSJhcnJvdyBqc0xpbmsiIGhyZWY9Imh0dHA6Ly93d3cuYm9zY2h0ZWNoaW5mby5jb20vIiB0YXJnZXQ9Il9ibGFuayIgPjxzcGFuIGNsYXNzPSJicmQiPjxzcGFuIGNsYXNzPSJicmRSaWdodCI%2BPGltZyBib3JkZXI9Im5vbmUiIGFsdD0iIiBzcmM9Ii9TdHlsZSUyMExpYnJhcnkvQkNTL0ltYWdlcy9hcnJvd19ncmV5Rmx5b3V0LmdpZiIgLz48c3BhbiBjbGFzcz0iZm9MaW5rIj5Cb3NjaCBMaXRlcmF0dXJlPC9zcGFuPjwvc3Bhbj48L3NwYW4%2BPHNwYW4gY2xhc3M9ImJyZEVuZCI%2BPHNwYW4gY2xhc3M9ImJyZFJFbmQiPjwvc3Bhbj48L3NwYW4%2BPC9hPjwvbGk%2BPC91bD48L2xpPjxsaSBjbGFzcz0ibm9TdWIiPjxhIGhyZWY9Imh0dHA6Ly93d3cuYm9zY2hjYXJzZXJ2aWNlLnVzL0RpZXNlbC9QYWdlcy9EaWVzZWxWZWhpY2xlRGlhZ25vc3RpY3MuYXNweCI%2BRGllc2VsPC9hPjwvbGk%2BPGxpIGNsYXNzPSJub1N1YiI%2BPGEgaHJlZj0iaHR0cDovL3d3dy5ib3NjaGNhcnNlcnZpY2UudXMvUGFnZXMvQ29udGFjdFVzLmFzcHgiPkNvbnRhY3QgVXM8L2E%2BPC9saT48L3VsPmQCFQ9kFhoCAw8WBB4TUHJldmlvdXNDb250cm9sTW9kZQspiAFNaWNyb3NvZnQuU2hhcmVQb2ludC5XZWJDb250cm9scy5TUENvbnRyb2xNb2RlLCBNaWNyb3NvZnQuU2hhcmVQb2ludCwgVmVyc2lvbj0xMi4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj03MWU5YmNlMTExZTk0MjljAR8BaGQCBQ8WBB8ICysEAR8BaGQCBw8WBB8ICysEAR8BaGQCCQ9kFgQCAQ8WBB4EaHJlZgUvL0ZpbmRTdmNDZW50ZXIvUGFnZXMvRmluZGluZ2FTZXJ2aWNlQ2VudGVyLmFzcHgfBwUhJmx0O0JhY2sgdG8gRmluZCBhIFNlcnZpY2UgQ2VudGVyZAIDD2QWBAIBDxYCHwFoZAIDDxYGHwcFE0ZvciBZb3VyIENhcmVlciZndDsfCQUVL1BhZ2VzL0Jvc2NoSm9icy5hc3B4HwFnZAILDxYCHwgLKwQBZAIPD2QWBGYPZBYIAgkPFgIfAwUOZGlzcGxheTpibG9jaztkAgsPEA8WBh4KRGF0YU1lbWJlcgULRGVzY3JpcHRpb24eDURhdGFUZXh0RmllbGQFC0Rlc2NyaXB0aW9uHgtfIURhdGFCb3VuZGcWAh8DBQ5kaXNwbGF5OmJsb2NrOxAVMBZTZWxlY3QgYSBWZWhpY2xlIEJyYW5kBUFjdXJhCkFsZmEgUm9tZW8EQXVkaQNCTVcFQnVpY2sIQ2FkaWxsYWMJQ2hldnJvbGV0CENocnlzbGVyBkRhZXdvbwVEb2RnZQVFYWdsZQdGZXJyYXJpBEZpYXQERm9yZANHZW8DR01DBUhvbmRhBkh1bW1lcgdIeXVuZGFpCEluZmluaXRpBUlzdXp1BkphZ3VhcgRKZWVwA0tpYQtMYW1ib3JnaGluaQpMYW5kIFJvdmVyBUxleHVzB0xpbmNvbG4FTWF6ZGENTWVyY2VkZXMtQmVuegdNZXJjdXJ5BE1pbmkKTWl0c3ViaXNoaQZOaXNzYW4KT2xkc21vYmlsZQhQbHltb3V0aAdQb250aWFjB1BvcnNjaGUEU2FhYgZTYXR1cm4FU2Npb24FU21hcnQGU3ViYXJ1BlN1enVraQZUb3lvdGEKVm9sa3N3YWdlbgVWb2x2bxUwFlNlbGVjdCBhIFZlaGljbGUgQnJhbmQFQWN1cmEKQWxmYSBSb21lbwRBdWRpA0JNVwVCdWljawhDYWRpbGxhYwlDaGV2cm9sZXQIQ2hyeXNsZXIGRGFld29vBURvZGdlBUVhZ2xlB0ZlcnJhcmkERmlhdARGb3JkA0dlbwNHTUMFSG9uZGEGSHVtbWVyB0h5dW5kYWkISW5maW5pdGkFSXN1enUGSmFndWFyBEplZXADS2lhC0xhbWJvcmdoaW5pCkxhbmQgUm92ZXIFTGV4dXMHTGluY29sbgVNYXpkYQ1NZXJjZWRlcy1CZW56B01lcmN1cnkETWluaQpNaXRzdWJpc2hpBk5pc3NhbgpPbGRzbW9iaWxlCFBseW1vdXRoB1BvbnRpYWMHUG9yc2NoZQRTYWFiBlNhdHVybgVTY2lvbgVTbWFydAZTdWJhcnUGU3V6dWtpBlRveW90YQpWb2xrc3dhZ2VuBVZvbHZvFCsDMGdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2RkAh0PEA8WBB4URGF0YVRleHRGb3JtYXRTdHJpbmcFCXswfSBtaWxlcx8MZ2QQFQYHNSBtaWxlcwgxMCBtaWxlcwgyNSBtaWxlcwg1MCBtaWxlcwg3NSBtaWxlcwkxMDAgbWlsZXMVBgE1AjEwAjI1AjUwAjc1AzEwMBQrAwZnZ2dnZ2dkZAInDw8WAh8ABStQbGVhc2UgZW50ZXIgYSB6aXAgY29kZSBvciBhIGNpdHkgYW5kIHN0YXRlFgIeBVN0eWxlBRJ2aXNpYmlsaXR5OmhpZGRlbjtkAgEPZBYCAgEPDxYEHhRtX29ialppcFNlYXJjaEVudGl0eTLsBAABAAAA%2F%2F%2F%2F%2FwEAAAAAAAAADAIAAABuUkIuTkEuQVVUTy5BRlRFUk1BUktFVC5CT1NDSFNFUlZJQ0UuSU5URVJORVQuVFJBTlNQT1JUUywgVmVyc2lvbj0xLjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPW51bGwFAQAAAEdSQi5OQS5BVVRPLkFGVEVSTUFSS0VULkJPU0NIU0VSVklDRS5JTlRFUk5FVC5UUkFOU1BPUlRTLlppcFNlYXJjaEVudGl0eQwAAAAYPFppcENvZGU%2Ba19fQmFja2luZ0ZpZWxkGTxEaXN0YW5jZT5rX19CYWNraW5nRmllbGQdPExvY2F0aW9uVHlwZT5rX19CYWNraW5nRmllbGQVPENpdHk%2Ba19fQmFja2luZ0ZpZWxkFjxTdGF0ZT5rX19CYWNraW5nRmllbGQYPEFkZHJlc3M%2Ba19fQmFja2luZ0ZpZWxkITxMaXN0QnNzTG9jYXRpb25zPmtfX0JhY2tpbmdGaWVsZCE8TGlzdEJQQ0xvY2F0aW9ucz5rX19CYWNraW5nRmllbGQXPEZpbHRlcj5rX19CYWNraW5nRmllbGQVPFBhcnQ%2Ba19fQmFja2luZ0ZpZWxkGzxJbmNsdWRlRlNDPmtfX0JhY2tpbmdGaWVsZBo8Q291bnRyeUlkPmtfX0JhY2tpbmdGaWVsZAEBAQEBAQAAAQEAAAEBAQgCAAAABgMAAAAFMTE3MDEGBAAAAAMxMDAGBQAAAAIxMwYGAAAACE5ldyBZb3JrBgcAAAACTlkKAAAGCAAAAAAKAAAAAAALHgxfQ3VycmVudFBhZ2UCAWQWBAIBDw8WBB8BaB8ABSVGYWlsZWQgdG8gbGlzdCBjb250ZXh0IGRhdGEgbG9jYXRpb25zZGQCAw8PFgIfAWdkFgQCAQ8WAh4LXyFJdGVtQ291bnQCBhYMZg9kFhBmDxUCATEkR2VybWFuIEF1dG8gUmVwYWlyIFRlY2huaWNpYW5zLCBJbmMuZAIBDw8WAh8ABSkxIEVsbSBQbGFjZTxici8%2BQW1pdHl2aWxsZSwgTlkgMTE3MDE8YnIvPmRkAgMPDxYCHwAFFVBob25lOiAoNjMxKSA3ODktMjQyNmRkAgUPDxYCHwAFE0ZheDogKDYzMSkgNzg5LTE2NjRkZAIGDxUBAGQCBw8PFgIfAAVzPGEgaHJlZj0naHR0cDovL3d3dy5nZXJtYW5hdXRvcmVwYWlydGVjaG5pY2lhbnMuY29tJyB0YXJnZXQ9Il9ibGFuayI%2BaHR0cDovL3d3dy5nZXJtYW5hdXRvcmVwYWlydGVjaG5pY2lhbnMuY29tPC9hPmRkAggPFQULMSBFbG0gUGxhY2UACkFtaXR5dmlsbGUCTlkFMTE3MDFkAgkPDxYCHwBlZGQCAQ9kFhBmDxUCATIbU3RyaWN0bHkgQXV0byBSZXBhaXJzLCBJbmMuZAIBDw8WAh8ABSk2MSBKb2huIFN0Ljxici8%2BQW1pdHl2aWxsZSwgTlkgMTE3MDE8YnIvPmRkAgMPDxYCHwAFFVBob25lOiAoNjMxKSA3ODktODUwMGRkAgUPDxYCHwAFE0ZheDogKDYzMSkgNjA4LTM3MTNkZAIGDxUBggE8YSBocmVmPSIvUGFnZXMvQm9zY2hTZXJ2aWNlQ3JlZGl0Q2FyZC5hc3B4Ij48aW1nIGFsdD0iQm9zY2ggU2VydmljZSBDcmVkaXQgQ2FyZCIgc3JjPSIvU2l0ZUNvbGxlY3Rpb25JbWFnZXMvQ0NpbmRpY2F0b3IuanBnIj48L2E%2BZAIHDw8WAh8ABWM8YSBocmVmPSdodHRwOi8vd3d3LnN0cmljdGx5YXV0b3JlcGFpcnMuY29tJyB0YXJnZXQ9Il9ibGFuayI%2BaHR0cDovL3d3dy5zdHJpY3RseWF1dG9yZXBhaXJzLmNvbTwvYT5kZAIIDxUFCzYxIEpvaG4gU3QuAApBbWl0eXZpbGxlAk5ZBTExNzAxZAIJDw8WAh8AZWRkAgIPZBYQZg8VAgEzEVRoZSBMaXR0bGUgR2FyYWdlZAIBDw8WAh8ABTc0NTYgV2VzdCBKZXJpY2hvIFR1cm5waWtlPGJyLz5IdW50aW5ndG9uLCBOWSAxMTc0Mzxici8%2BZGQCAw8PFgIfAAUVUGhvbmU6ICg2MzEpIDY3My0xNzAwZGQCBQ8PFgIfAAUTRmF4OiAoNjMxKSA2NzMtODc1M2RkAgYPFQEAZAIHDw8WAh8ABVU8YSBocmVmPSdodHRwOi8vd3d3LmxpdHRsZWdhcmFnZS5jb20nIHRhcmdldD0iX2JsYW5rIj5odHRwOi8vd3d3LmxpdHRsZWdhcmFnZS5jb208L2E%2BZGQCCA8VBRk0NTYgV2VzdCBKZXJpY2hvIFR1cm5waWtlAApIdW50aW5ndG9uAk5ZBTExNzQzZAIJDw8WAh8ABYkBPGEgaHJlZj0nL1BhZ2VzL1NwZWNpYWxPZmZlcnMuYXNweD9NYW5hZ2VySWQ9QlNDMTgwMyZMb2NhdG9ySWQ9MTMmU2VydmljZUNlbnRlck5hbWU9VGhlIExpdHRsZSBHYXJhZ2UnIHRhcmdldD0iX2JsYW5rIj5TcGVjaWFsIE9mZmVyczwvYT5kZAIDD2QWEGYPFQIBNBhBdXRvIFNwb3J0IERlc2lnbnMsIEluYy5kAgEPDxYCHwAFOTIwMyBXZXN0IEhpbGxzIFJvYWQ8YnIvPkh1bnRpbmd0b24gU3RhdGlvbiwgTlkgMTE3NDY8YnIvPmRkAgMPDxYCHwAFFVBob25lOiAoNjMxKSA0MjUtMTU1NWRkAgUPDxYCHwAFE0ZheDogKDYzMSkgNDI1LTYxODVkZAIGDxUBAGQCBw8PFgIfAAVdPGEgaHJlZj0naHR0cDovL3d3dy5hdXRvc3BvcnRkZXNpZ25zLmNvbScgdGFyZ2V0PSJfYmxhbmsiPmh0dHA6Ly93d3cuYXV0b3Nwb3J0ZGVzaWducy5jb208L2E%2BZGQCCA8VBRMyMDMgV2VzdCBIaWxscyBSb2FkABJIdW50aW5ndG9uIFN0YXRpb24CTlkFMTE3NDZkAgkPDxYCHwBlZGQCBA9kFhBmDxUCATUPSW1wb3J0IEF1dG9oYXVzZAIBDw8WAh8ABTIyNjMgQnJvYWR3YXk8YnIvPkh1bnRpbmd0b24gU3RhdGlvbiwgTlkgMTE3NDY8YnIvPmRkAgMPDxYCHwAFFVBob25lOiAoNjMxKSA1NDktOTYwOGRkAgUPDxYCHwAFE0ZheDogKDYzMSkgNTQ5LTk1MDZkZAIGDxUBAGQCBw8PFgIfAGVkZAIIDxUFDDI2MyBCcm9hZHdheQASSHVudGluZ3RvbiBTdGF0aW9uAk5ZBTExNzQ2ZAIJDw8WAh8AZWRkAgUPZBYQZg8VAgE2FUpTUyBQZXJmb3JtYW5jZSwgSW5jLmQCAQ8PFgIfAAUpNDMgUm9zZWxsZSBTdC48YnIvPk1pbmVvbGEsIE5ZIDExNTAxPGJyLz5kZAIDDw8WAh8ABRVQaG9uZTogKDUxNikgODc3LTk4OTlkZAIFDw8WAh8ABRNGYXg6ICg1MTYpIDc1MC01MTE1ZGQCBg8VAYIBPGEgaHJlZj0iL1BhZ2VzL0Jvc2NoU2VydmljZUNyZWRpdENhcmQuYXNweCI%2BPGltZyBhbHQ9IkJvc2NoIFNlcnZpY2UgQ3JlZGl0IENhcmQiIHNyYz0iL1NpdGVDb2xsZWN0aW9uSW1hZ2VzL0NDaW5kaWNhdG9yLmpwZyI%2BPC9hPmQCBw8PFgIfAAVZPGEgaHJlZj0naHR0cDovL3d3dy5qc3NwZXJmb3JtYW5jZS5jb20nIHRhcmdldD0iX2JsYW5rIj5odHRwOi8vd3d3Lmpzc3BlcmZvcm1hbmNlLmNvbTwvYT5kZAIIDxUFDjQzIFJvc2VsbGUgU3QuAAdNaW5lb2xhAk5ZBTExNTAxZAIJDw8WAh8ABY0BPGEgaHJlZj0nL1BhZ2VzL1NwZWNpYWxPZmZlcnMuYXNweD9NYW5hZ2VySWQ9QlNDMTQ5MyZMb2NhdG9ySWQ9MTMmU2VydmljZUNlbnRlck5hbWU9SlNTIFBlcmZvcm1hbmNlLCBJbmMuJyB0YXJnZXQ9Il9ibGFuayI%2BU3BlY2lhbCBPZmZlcnM8L2E%2BZGQCAw8PFgIfAWdkFghmDw8WAh8BaGRkAgEPDxYCHwFoZGQCAg8PFgIfAWdkZAIDDw8WAh8BZ2RkAhEPFgIfCAsrBAFkAhMPFgIfCAsrBAFkAhUPFgIfCAsrBAFkAhcPFgIfCAsrBAFkAhkPFgIfCAsrBAFkAhsPFgIfCAsrBAFkAh0PFgIfCAsrBAFkAhcPZBYGAgEPDxYCHwFnZGQCAw8PFgIfAWdkZAIFDxYCHwAFpwI8YSB0aXRsZT0gSW1wcmludCBocmVmPSJodHRwOi8vd3d3LmJvc2NoY2Fyc2VydmljZS51cy9QYWdlcy9JbXByaW50LmFzcHgiPkltcHJpbnQ8L2E%2BIHwgPGEgdGl0bGU9IFByaXZhY3kgUG9saWN5IGhyZWY9Imh0dHA6Ly93d3cuYm9zY2hjYXJzZXJ2aWNlLnVzL1BhZ2VzL1ByaXZhY3kuYXNweCI%2BUHJpdmFjeSBQb2xpY3k8L2E%2BIHwgPGEgdGl0bGU9IFRlcm1zICYgQ29uZGl0aW9ucyBocmVmPSJodHRwOi8vd3d3LmJvc2NoY2Fyc2VydmljZS51cy9QYWdlcy9UZXJtcy5hc3B4Ij5UZXJtcyAmIENvbmRpdGlvbnM8L2E%2BZAIZD2QWBGYPDxYCHwFoZGQCAg8PFgIfAWhkZBgBBR5fX0NvbnRyb2xzUmVxdWlyZVBvc3RCYWNrS2V5X18WCgVDY3RsMDAkUGxhY2VIb2xkZXJNYWluJFNlcnZpY2VDZW50ZXJTZWFyY2gkcmJBdXRvbW90aXZlU2VydmljZUNlbnRlcgU%2FY3RsMDAkUGxhY2VIb2xkZXJNYWluJFNlcnZpY2VDZW50ZXJTZWFyY2gkcmJEaWVzZWxTZXJ2aWNlQ2VudGVyBT9jdGwwMCRQbGFjZUhvbGRlck1haW4kU2VydmljZUNlbnRlclNlYXJjaCRyYkRpZXNlbFNlcnZpY2VDZW50ZXIFP2N0bDAwJFBsYWNlSG9sZGVyTWFpbiRTZXJ2aWNlQ2VudGVyU2VhcmNoJHJiRGllc2VsU2VydmljZURlYWxlcgU%2FY3RsMDAkUGxhY2VIb2xkZXJNYWluJFNlcnZpY2VDZW50ZXJTZWFyY2gkcmJEaWVzZWxTZXJ2aWNlRGVhbGVyBUNjdGwwMCRQbGFjZUhvbGRlck1haW4kU2VydmljZUNlbnRlclNlYXJjaCRyYkhlYXZ5RHV0eUVsZWN0cmljQ2VudGVyBUNjdGwwMCRQbGFjZUhvbGRlck1haW4kU2VydmljZUNlbnRlclNlYXJjaCRyYkhlYXZ5RHV0eUVsZWN0cmljQ2VudGVyBUBjdGwwMCRQbGFjZUhvbGRlck1haW4kU2VydmljZUNlbnRlclNlYXJjaCRjaGtBdXRvU0NTcGVjaWFsT2ZmZXJzBU1jdGwwMCRQbGFjZUhvbGRlck1haW4kU2VydmljZUNlbnRlclNlYXJjaCR1Y1NlcnZpY2VDZW50ZXJTZWFyY2hSZXN1bHQkYnRuTmV4dAVNY3RsMDAkUGxhY2VIb2xkZXJNYWluJFNlcnZpY2VDZW50ZXJTZWFyY2gkdWNTZXJ2aWNlQ2VudGVyU2VhcmNoUmVzdWx0JGJ0bkxhc3Sn7CpD%2BLwjq%2FQD555y3urSer52Lg%3D%3D&__EVENTVALIDATION=%2FwEWjAECiaT73A8C%2BvTlyQgC%2Fs78uAkC2uTangUC8rLwowwC67uOjQYCg%2BDUwwkCj6XavwkCnLvxywUCjdXruwkCzdf1mQQCjsC%2BkQIC1pPW%2BAsC%2FdGDiA8C98%2BLgwUCuLenzgECk96OhgcC5YKjrgkCuLzcyQMCp5HRwwsCsv%2FGzA8CkMeK6A8CjMXvmgoCqdGHlAgCivjpiAcCvqX7gQMCwaCOzgEC86e6pQMC%2Bp2PrQoCr875gg4C0pLhlgsC%2B%2Fuz1Q4Cg%2FrKjwIC9d6DlgcC27i2hQkCqqii7wUC6o%2F%2F1wECt6yvtwwC7%2B6sugQC8oPBqA0CmtrLwQUCi53qxA4C2siWqw0CiL3%2B1Q4C7MSHjQ0CypKpxwUCj87VmQ0CktzG8wEC5JbcwgwCiY%2B%2BigcC6qrqUwKLsficAgL8g4z7CQKngOvrAgKx8ozmBgKCgavFAgLr5ZfQBAK35cvNBAK35c%2FNBAK35dPNBAK35a%2FNBAK35fPMBAK35ZPNBAK35dfNBAK35efNBAK35ZvNBAK25e%2FNBAK15dfNBAK15d%2FNBAK15avNBAK05efNBAK05e%2FNBAKy5cvNBAKx5dfNBAKx5afNBAKA5bfNBAKP5evNBAKP5cvNBAKP5cPNBAKP5dfNBAKN5a%2FNBAKN5ffMBAKM5dfNBAKL5efNBAKL5dPNBAKL5ZvNBAKL5evNBAKL5dfNBAKL5bfNBAKL5cPNBAKL5a%2FNBAKL5d%2FNBAKL5avNBAKK5efNBAKK5aPNBAKK5dPNBAKK5bvNBAKK5bPNBAKK5cfNBAKK5ffMBAKK5cvNBAKK5e%2FNBAKK5evNBAKK5avNBAKK5a%2FNBAKK5afNBAKJ5bvNBAKJ5c%2FNBAKJ5cPNBAKJ5ZPNBAKY5dfNBAKY5efNBAKY5ZPNBAKH5e%2FNBAKG5bfNBAKF5c%2FNBAKF5e%2FNBAKF5evNBAKE5cPNBAKE5fvMBAKC5bfNBAKD5avNBAKC5avNBAKC5dfNBAKB5dfNBAKB5aPNBAKB5bfNBAKB5ffMBAKf5avNBAK%2BzNnpCgLc%2BI3CBQLY%2BM3BBQLZ%2BPHBBQLc%2BM3BBQLe%2BPHBBQL%2BuaqWAgKrm4urDQKkh%2BvuBAKIrvyICQL00tfKAS5b5JZ3mIPHCF9kJ0IQaB9m3xce&ctl00%24PlaceHolderMain%24ucBreadCrumbs%24hiddenText=&ctl00%24PlaceHolderMain%24ServiceCenterSearch%24ServiceLocator='.$t.'&ctl00%24PlaceHolderMain%24ServiceCenterSearch%24ddlVehicleMake=Select+a+Vehicle+Brand&ctl00%24PlaceHolderMain%24ServiceCenterSearch%24txtAddress=&ctl00%24PlaceHolderMain%24ServiceCenterSearch%24txtCity='.$city.'&ctl00%24PlaceHolderMain%24ServiceCenterSearch%24ddlState='.$state.'&ctl00%24PlaceHolderMain%24ServiceCenterSearch%24txtZipCode='.$zip.'&ctl00%24PlaceHolderMain%24ServiceCenterSearch%24ddlRadius=100&ctl00%24PlaceHolderMain%24ServiceCenterSearch%24submitButton=Start+Search';
//'.$city.' '.$state.'
			//	$post = $this->buildQuery($data,3 );

				$webRequests[] = new WebRequest($url, $type, "POST", $post);
			}
			if (sizeof($webRequests) > 0)
				$this->loadWebRequests($webRequests);

			$webRequests=array();
      }
		
		
   }

	static function parse($url,$html)
	{
		
		$type = get_class();		
		$html = preg_replace("/(\t|\n|\r)+/"," ",$html);
		$dom = new DOMDocument();
		@$dom->loadHTML($html);
		$x = new DOMXPath($dom);	
		
		
		// get the list of salons
		//*[@id="Table3"]
		foreach ($x->query("//tr[@id='test']") as $node)
		{

			$dom2 = new DOMDocument();
			@$dom2->loadHTML($node->c14n());
			$x2 = new DOMXPath($dom2);	
			$data=array();
			$ap = new Address_Parser();


			foreach ($x2->query("//td//b") as $node2)
			{
				$data['NAME'] = trim($node2->textContent);
			}

			foreach ($x2->query("//span[contains(@id,'lblAddress')]") as $node2)
			{
				$data = array_merge($data,$ap->parse($node2->c14n()));
			}

		
			foreach ($x2->query("//span[contains(@id,'lblPhone')]") as $node2)
			{
				$data['PHONE'] = trim($node2->textContent);
			}
			
			foreach ($x2->query("//span[contains(@id,'lblFax')]") as $node2)
			{
				$data['FAX'] = trim($node2->textContent);
			}
			foreach ($x2->query("//span[contains(@id,'lblUrl')]") as $node2)
			{
				$data['WEBSITE'] = trim($node2->textContent);
			}
	
			if (!array_key_exists('NAME', $data)) continue;

			
			if (array_key_exists('NAME', $data))
			{
				if (! array_key_exists('ZIP', $data))
				{
					log::error("NO match");
					global $nomatch;

					$nomatch[] = $matches;

					continue;
				}

				$data['SOURCE_URL'] = $url;
				//log::info($data['NAME']);
				db::store($type, $data,array('NAME','PHONE'),false);

			 
			  # this is a bit faster...
			  # db::replaceInto($type,$data);
			}
			echo ".";
		}


		echo ".";

	}


	static function removeSpaces($str)
	{
			return preg_replace("/(\t|\n|\r| )+/","",$str);
	}
	
	static function cleanup($str)
	{
		while (preg_match("/  /",$str))
		{
			$str = preg_replace("/  /i"," ",$str);
		}
		return trim($str);
	}

}


$r= new boschservice();
$r->parseCommandLine();