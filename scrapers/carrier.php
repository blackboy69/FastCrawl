<?
include_once "config.inc";
include_once "search_engine_yahoo_local.php";

class carrier extends baseScrape
{
    public static $_this=null;
   

   public function runLoader()
   {
      $type = get_class();    

      //$this->maxRetries = 100;
      //$this->timeout = 15;
      $this->useCookies=true;
      $this->allowRedirects = true;
      $this->debug=false;
//    $this->threads=2;
// $this->debug=true;
   //log::error_level(ERROR_DEBUG_VERBOSE);
      
      /*
      db::query("
      UPDATE load_queue SET processing = 1 WHERE url IN (SELECT url FROM raw_data)      
          ");

      */
      // cananda top 100 cities by population
     // db::query("DELETE FROM raw_data where type = '$type' ");
	//    db::query("DELETE FROM load_queue where type='$type'");
//      db::query("DELETE FROM raw_data WHERE type = '$type' ");

//      db::query("DROP TABLE $type ");
      //db::query("UPDATE load_queue SET processing = 1 where type = '$type'  ");

      $webRequests= array();
//    $this->noProxy= false;
		// $this->proxy = "localhost:8888";

		$result = mysql_query("SELECT distinct zip,state FROM geo.locations order by pop desc LIMIT 2000") ;
      while ($r = mysql_fetch_row($result))
      {
			$zip = $r[0];
			$url = "http://www.carrier.com/homecomfort/en/us/find-a-dealer/?$zip";
			$postData="__EVENTTARGET=&__EVENTARGUMENT=&__VIEWSTATE=%2FwEPDwUKMTU4ODE3Njc5Ng9kFgJmD2QWAgIBDxYCHgZhY3Rpb24FIS9ob21lY29tZm9ydC9lbi91cy9maW5kLWEtZGVhbGVyLxYEAgEPZBYCZg9kFgJmD2QWBAIBDw9kFgIeC3BsYWNlaG9sZGVyBQZTRUFSQ0hkAgMPDxYCHgtQb3N0QmFja1VybAUKfi8vc2VhcmNoLxYCHgV0aXRsZQUGU2VhcmNoZAICD2QWAgICD2QWBGYPFgQeBGhyZWYFIS9ob21lY29tZm9ydC9lbi91cy9maW5kLWEtZGVhbGVyLx4HVmlzaWJsZWhkAgMPFgIeC18hSXRlbUNvdW50AgMWBmYPZBYWZg8VFQExF1BldGVyc29uIE1lY2hhbmljYWwgSW5jDjIxODE5IDh0aCBTdCBFBlNvbm9tYQJDQQU5NTQ3Ngw3MDctOTMxLTA3NzJEaHR0cDovL3d3dy5wZXRlcnNvbm1lY2hhbmljYWwuY29tL2h2YWMtc2VydmljZS9yZXNpZGVudGlhbC1odmFjLmh0bWwGMzguMjU3CS0xMjIuNDU5NwIwMQExF1BldGVyc29uIE1lY2hhbmljYWwgSW5jDjIxODE5IDh0aCBTdCBFBlNvbm9tYQJDQQU5NTQ3Ngw3MDctOTMxLTA3NzJEaHR0cDovL3d3dy5wZXRlcnNvbm1lY2hhbmljYWwuY29tL2h2YWMtc2VydmljZS9yZXNpZGVudGlhbC1odmFjLmh0bWwGMzguMjU3CS0xMjIuNDU5N2QCAQ8VBgQ1OTkyF1BldGVyc29uIE1lY2hhbmljYWwgSW5jDjIxODE5IDh0aCBTdCBFBlNvbm9tYQJDQc4BOTU0NzYgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnIgLz5kAgIPFQbiATIxODE5IDh0aCBTdCBFIFNvbm9tYSwgQ0EgOTU0NzYgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAXUGV0ZXJzb24gTWVjaGFuaWNhbCBJbmMOMjE4MTkgOHRoIFN0IEUGU29ub21hAkNBBTk1NDc2ZAIDDxUHRGh0dHA6Ly93d3cucGV0ZXJzb25tZWNoYW5pY2FsLmNvbS9odmFjLXNlcnZpY2UvcmVzaWRlbnRpYWwtaHZhYy5odG1sRGh0dHA6Ly93d3cucGV0ZXJzb25tZWNoYW5pY2FsLmNvbS9odmFjLXNlcnZpY2UvcmVzaWRlbnRpYWwtaHZhYy5odG1sP0J1c2luZXNzIEhvdXJzOiBOb3JtYWwgSG91cnMgd2l0aCBBZnRlci1ob3VycyBBbnN3ZXJpbmcgU2VydmljZT88YnI%2BWWVhcnMgaW4gQnVzaW5lc3M6IE1vcmUgdGhhbiA1MCB5ZWFycyBvZiBzZXJ2aW5nIGhvbWVvd25lcnPsBzxwIGNsYXNzPSJkZWFsZXItYmFkZ2VzIG1hcjAiPjxhIHRpdGxlPSJGYWN0b3J5IEF1dGhvcml6ZWQiICBkYXRhLWRlc2M9IiIgaHJlZj0iL2hvbWVjb21mb3J0L2VuL3VzL2NhcnJpZXItZXhwZXJ0cy8jMSIgdGFyZ2V0PSJfc2VsZiIgY2xhc3M9InRvb2x0aXBjbGFzcyBtcjEwICI%2BPGltZyBzcmM9Ii8vZmlsZXMuY2Fycmllci5jb20vaG9tZWNvbWZvcnQvZW4vdXMvY29udGVudGltYWdlcy9pY24tZGVhbC1mYWQucG5nIiBhbHQ9IkJhZGdlIj4gPC9pbWc%2BPC9hPjxhIHRpdGxlPSJOQVRFIFRyYWluZWQiICBkYXRhLWRlc2M9IiIgaHJlZj0iL2hvbWVjb21mb3J0L2VuL3VzL2NhcnJpZXItZXhwZXJ0cy8jMSIgdGFyZ2V0PSJfc2VsZiIgY2xhc3M9InRvb2x0aXBjbGFzcyBtcjEwICI%2BPGltZyBzcmM9Ii8vZmlsZXMuY2Fycmllci5jb20vaG9tZWNvbWZvcnQvZW4vdXMvY29udGVudGltYWdlcy9pY25fbmF0ZV9sb2dvLnBuZyIgYWx0PSJCYWRnZSI%2BIDwvaW1nPjwvYT48YSB0aXRsZT0iQ29vbCBDYXNoIFByb21vdGlvbiIgIGRhdGEtZGVzYz0iIiBocmVmPSIvaG9tZWNvbWZvcnQvZW4vdXMvcmViYXRlcy1hbmQtZmluYW5jaW5nLyMwIiB0YXJnZXQ9Il9zZWxmIiBjbGFzcz0idG9vbHRpcGNsYXNzIG1yMTAgIj48aW1nIHNyYz0iLy9maWxlcy5jYXJyaWVyLmNvbS9ob21lY29tZm9ydC9lbi91cy9jb250ZW50aW1hZ2VzL2ljbi1kZWFsLWNvb2wucG5nIiBhbHQ9IkJhZGdlIj4gPC9pbWc%2BPC9hPjxhIHRpdGxlPSJEdWN0bGVzcyBTcGxpdCBTeXN0ZW1zIiAgZGF0YS1kZXNjPSIiIGhyZWY9Ii9ob21lY29tZm9ydC9lbi91cy9wcm9kdWN0cy9oZWF0aW5nLWFuZC1jb29saW5nL2R1Y3RsZXNzLXN5c3RlbXMvIiB0YXJnZXQ9Il9zZWxmIiBjbGFzcz0idG9vbHRpcGNsYXNzIG1yMTAgIj48aW1nIHNyYz0iLy9maWxlcy5jYXJyaWVyLmNvbS9ob21lY29tZm9ydC9lbi91cy9jb250ZW50aW1hZ2VzL2ljbi1kdWN0ZnJlZV9sZy5wbmciIGFsdD0iQmFkZ2UiPiA8L2ltZz48L2E%2BDDcwNy05MzEtMDc3Mgw3MDctOTMxLTA3NzJkAgQPFQYENTk5MhdQZXRlcnNvbiBNZWNoYW5pY2FsIEluYw4yMTgxOSA4dGggU3QgRQZTb25vbWECQ0EFOTU0NzZkAgUPFRUBMRdQZXRlcnNvbiBNZWNoYW5pY2FsIEluYw4yMTgxOSA4dGggU3QgRQZTb25vbWECQ0EFOTU0NzYMNzA3LTkzMS0wNzcyRGh0dHA6Ly93d3cucGV0ZXJzb25tZWNoYW5pY2FsLmNvbS9odmFjLXNlcnZpY2UvcmVzaWRlbnRpYWwtaHZhYy5odG1sBjM4LjI1NwktMTIyLjQ1OTcBMQExF1BldGVyc29uIE1lY2hhbmljYWwgSW5jDjIxODE5IDh0aCBTdCBFBlNvbm9tYQJDQQU5NTQ3Ngw3MDctOTMxLTA3NzJEaHR0cDovL3d3dy5wZXRlcnNvbm1lY2hhbmljYWwuY29tL2h2YWMtc2VydmljZS9yZXNpZGVudGlhbC1odmFjLmh0bWwGMzguMjU3CS0xMjIuNDU5N2QCBg8VCAQ1OTkyF1BldGVyc29uIE1lY2hhbmljYWwgSW5jE1Bob25lOiA3MDctOTMxLTA3NzITUGhvbmU6IDcwNy05MzEtMDc3Mg4yMTgxOSA4dGggU3QgRQZTb25vbWECQ0HOATk1NDc2ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJyIC8%2BZAIHDxUG4gEyMTgxOSA4dGggU3QgRSBTb25vbWEsIENBIDk1NDc2ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgF1BldGVyc29uIE1lY2hhbmljYWwgSW5jDjIxODE5IDh0aCBTdCBFBlNvbm9tYQJDQQU5NTQ3NmQCCA8VBD9CdXNpbmVzcyBIb3VyczogTm9ybWFsIEhvdXJzIHdpdGggQWZ0ZXItaG91cnMgQW5zd2VyaW5nIFNlcnZpY2U%2FPGJyPlllYXJzIGluIEJ1c2luZXNzOiBNb3JlIHRoYW4gNTAgeWVhcnMgb2Ygc2VydmluZyBob21lb3duZXJzRGh0dHA6Ly93d3cucGV0ZXJzb25tZWNoYW5pY2FsLmNvbS9odmFjLXNlcnZpY2UvcmVzaWRlbnRpYWwtaHZhYy5odG1sRGh0dHA6Ly93d3cucGV0ZXJzb25tZWNoYW5pY2FsLmNvbS9odmFjLXNlcnZpY2UvcmVzaWRlbnRpYWwtaHZhYy5odG1sZAIJDxUGBDU5OTIXUGV0ZXJzb24gTWVjaGFuaWNhbCBJbmMOMjE4MTkgOHRoIFN0IEUGU29ub21hAkNBBTk1NDc2ZAIKDxUB7Ac8cCBjbGFzcz0iZGVhbGVyLWJhZGdlcyBtYXIwIj48YSB0aXRsZT0iRmFjdG9yeSBBdXRob3JpemVkIiAgZGF0YS1kZXNjPSIiIGhyZWY9Ii9ob21lY29tZm9ydC9lbi91cy9jYXJyaWVyLWV4cGVydHMvIzEiIHRhcmdldD0iX3NlbGYiIGNsYXNzPSJ0b29sdGlwY2xhc3MgbXIxMCAiPjxpbWcgc3JjPSIvL2ZpbGVzLmNhcnJpZXIuY29tL2hvbWVjb21mb3J0L2VuL3VzL2NvbnRlbnRpbWFnZXMvaWNuLWRlYWwtZmFkLnBuZyIgYWx0PSJCYWRnZSI%2BIDwvaW1nPjwvYT48YSB0aXRsZT0iTkFURSBUcmFpbmVkIiAgZGF0YS1kZXNjPSIiIGhyZWY9Ii9ob21lY29tZm9ydC9lbi91cy9jYXJyaWVyLWV4cGVydHMvIzEiIHRhcmdldD0iX3NlbGYiIGNsYXNzPSJ0b29sdGlwY2xhc3MgbXIxMCAiPjxpbWcgc3JjPSIvL2ZpbGVzLmNhcnJpZXIuY29tL2hvbWVjb21mb3J0L2VuL3VzL2NvbnRlbnRpbWFnZXMvaWNuX25hdGVfbG9nby5wbmciIGFsdD0iQmFkZ2UiPiA8L2ltZz48L2E%2BPGEgdGl0bGU9IkNvb2wgQ2FzaCBQcm9tb3Rpb24iICBkYXRhLWRlc2M9IiIgaHJlZj0iL2hvbWVjb21mb3J0L2VuL3VzL3JlYmF0ZXMtYW5kLWZpbmFuY2luZy8jMCIgdGFyZ2V0PSJfc2VsZiIgY2xhc3M9InRvb2x0aXBjbGFzcyBtcjEwICI%2BPGltZyBzcmM9Ii8vZmlsZXMuY2Fycmllci5jb20vaG9tZWNvbWZvcnQvZW4vdXMvY29udGVudGltYWdlcy9pY24tZGVhbC1jb29sLnBuZyIgYWx0PSJCYWRnZSI%2BIDwvaW1nPjwvYT48YSB0aXRsZT0iRHVjdGxlc3MgU3BsaXQgU3lzdGVtcyIgIGRhdGEtZGVzYz0iIiBocmVmPSIvaG9tZWNvbWZvcnQvZW4vdXMvcHJvZHVjdHMvaGVhdGluZy1hbmQtY29vbGluZy9kdWN0bGVzcy1zeXN0ZW1zLyIgdGFyZ2V0PSJfc2VsZiIgY2xhc3M9InRvb2x0aXBjbGFzcyBtcjEwICI%2BPGltZyBzcmM9Ii8vZmlsZXMuY2Fycmllci5jb20vaG9tZWNvbWZvcnQvZW4vdXMvY29udGVudGltYWdlcy9pY24tZHVjdGZyZWVfbGcucG5nIiBhbHQ9IkJhZGdlIj4gPC9pbWc%2BPC9hPmQCAQ9kFhpmDxUVATIXU2ltcHNvbiBTaGVldCBNZXRhbCBJbmMPMjgzMyBEb3dkIERyaXZlClNBTlRBIFJPU0ECQ0EFOTU0MDUMNzA3LTYyMy0xNDQyIGh0dHA6Ly93d3cuc2ltcHNvbnNoZWV0bWV0YWwuY29tBzM4LjQzOTgJLTEyMi42Njg1AjAyATIXU2ltcHNvbiBTaGVldCBNZXRhbCBJbmMPMjgzMyBEb3dkIERyaXZlClNBTlRBIFJPU0ECQ0EFOTU0MDUMNzA3LTYyMy0xNDQyIGh0dHA6Ly93d3cuc2ltcHNvbnNoZWV0bWV0YWwuY29tBzM4LjQzOTgJLTEyMi42Njg1ZAIBDxUGBDk2NTkXU2ltcHNvbiBTaGVldCBNZXRhbCBJbmMPMjgzMyBEb3dkIERyaXZlClNBTlRBIFJPU0ECQ0HOATk1NDA1ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJyIC8%2BZAICDxUG5wEyODMzIERvd2QgRHJpdmUgU0FOVEEgUk9TQSwgQ0EgOTU0MDUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAXU2ltcHNvbiBTaGVldCBNZXRhbCBJbmMPMjgzMyBEb3dkIERyaXZlClNBTlRBIFJPU0ECQ0EFOTU0MDVkAgMPFQQgaHR0cDovL3d3dy5zaW1wc29uc2hlZXRtZXRhbC5jb20gaHR0cDovL3d3dy5zaW1wc29uc2hlZXRtZXRhbC5jb20%2FQnVzaW5lc3MgSG91cnM6IE5vcm1hbCBIb3VycyB3aXRoIEFmdGVyLWhvdXJzIEFuc3dlcmluZyBTZXJ2aWNlOzxici8%2BWWVhcnMgaW4gQnVzaW5lc3M6IE92ZXIgMzAgeWVhcnMgb2Ygc2VydmluZyBob21lb3duZXJzZAIEDxUB2Ak8cCBjbGFzcz0iZGVhbGVyLWJhZGdlcyBtYXIwIj48YSB0aXRsZT0iRmFjdG9yeSBBdXRob3JpemVkIiAgZGF0YS1kZXNjPSIiIGhyZWY9Ii9ob21lY29tZm9ydC9lbi91cy9jYXJyaWVyLWV4cGVydHMvIzEiIHRhcmdldD0iX3NlbGYiIGNsYXNzPSJ0b29sdGlwY2xhc3MgbXIxMCAiPjxpbWcgc3JjPSIvL2ZpbGVzLmNhcnJpZXIuY29tL2hvbWVjb21mb3J0L2VuL3VzL2NvbnRlbnRpbWFnZXMvaWNuLWRlYWwtZmFkLnBuZyIgYWx0PSJCYWRnZSI%2BIDwvaW1nPjwvYT48YSB0aXRsZT0iTkFURSBUcmFpbmVkIiAgZGF0YS1kZXNjPSIiIGhyZWY9Ii9ob21lY29tZm9ydC9lbi91cy9jYXJyaWVyLWV4cGVydHMvIzEiIHRhcmdldD0iX3NlbGYiIGNsYXNzPSJ0b29sdGlwY2xhc3MgbXIxMCAiPjxpbWcgc3JjPSIvL2ZpbGVzLmNhcnJpZXIuY29tL2hvbWVjb21mb3J0L2VuL3VzL2NvbnRlbnRpbWFnZXMvaWNuX25hdGVfbG9nby5wbmciIGFsdD0iQmFkZ2UiPiA8L2ltZz48L2E%2BPGEgdGl0bGU9IkZpbmFuY2luZyBPZmZlcmVkIiAgZGF0YS1kZXNjPSIiIGhyZWY9Ii9ob21lY29tZm9ydC9lbi91cy9yZWJhdGVzLWFuZC1maW5hbmNpbmcvIzEiIHRhcmdldD0iX3NlbGYiIGNsYXNzPSJ0b29sdGlwY2xhc3MgbXIxMCAiPjxpbWcgc3JjPSIvL2ZpbGVzLmNhcnJpZXIuY29tL2hvbWVjb21mb3J0L2VuL3VzL2NvbnRlbnRpbWFnZXMvZmluYW5jaW5nLnBuZyIgYWx0PSJCYWRnZSI%2BIDwvaW1nPjwvYT48YSB0aXRsZT0iQ29vbCBDYXNoIFByb21vdGlvbiIgIGRhdGEtZGVzYz0iIiBocmVmPSIvaG9tZWNvbWZvcnQvZW4vdXMvcmViYXRlcy1hbmQtZmluYW5jaW5nLyMwIiB0YXJnZXQ9Il9zZWxmIiBjbGFzcz0idG9vbHRpcGNsYXNzIG1yMTAgIj48aW1nIHNyYz0iLy9maWxlcy5jYXJyaWVyLmNvbS9ob21lY29tZm9ydC9lbi91cy9jb250ZW50aW1hZ2VzL2ljbi1kZWFsLWNvb2wucG5nIiBhbHQ9IkJhZGdlIj4gPC9pbWc%2BPC9hPjxhIHRpdGxlPSJEdWN0bGVzcyBTcGxpdCBTeXN0ZW1zIiAgZGF0YS1kZXNjPSIiIGhyZWY9Ii9ob21lY29tZm9ydC9lbi91cy9wcm9kdWN0cy9oZWF0aW5nLWFuZC1jb29saW5nL2R1Y3RsZXNzLXN5c3RlbXMvIiB0YXJnZXQ9Il9zZWxmIiBjbGFzcz0idG9vbHRpcGNsYXNzIG1yMTAgIj48aW1nIHNyYz0iLy9maWxlcy5jYXJyaWVyLmNvbS9ob21lY29tZm9ydC9lbi91cy9jb250ZW50aW1hZ2VzL2ljbi1kdWN0ZnJlZV9sZy5wbmciIGFsdD0iQmFkZ2UiPiA8L2ltZz48L2E%2BZAIFDxUCDDcwNy02MjMtMTQ0Mgw3MDctNjIzLTE0NDJkAgYPFQYEOTY1ORdTaW1wc29uIFNoZWV0IE1ldGFsIEluYw8yODMzIERvd2QgRHJpdmUKU0FOVEEgUk9TQQJDQQU5NTQwNWQCBw8VFQEyF1NpbXBzb24gU2hlZXQgTWV0YWwgSW5jDzI4MzMgRG93ZCBEcml2ZQpTQU5UQSBST1NBAkNBBTk1NDA1DDcwNy02MjMtMTQ0MiBodHRwOi8vd3d3LnNpbXBzb25zaGVldG1ldGFsLmNvbQczOC40Mzk4CS0xMjIuNjY4NQEyATIXU2ltcHNvbiBTaGVldCBNZXRhbCBJbmMPMjgzMyBEb3dkIERyaXZlClNBTlRBIFJPU0ECQ0EFOTU0MDUMNzA3LTYyMy0xNDQyIGh0dHA6Ly93d3cuc2ltcHNvbnNoZWV0bWV0YWwuY29tBzM4LjQzOTgJLTEyMi42Njg1ZAIIDxUIBDk2NTkXU2ltcHNvbiBTaGVldCBNZXRhbCBJbmMYPGJyLz5QaG9uZTogNzA3LTYyMy0xNDQyE1Bob25lOiA3MDctNjIzLTE0NDIPMjgzMyBEb3dkIERyaXZlClNBTlRBIFJPU0ECQ0HOATk1NDA1ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJyIC8%2BZAIJDxUG5wEyODMzIERvd2QgRHJpdmUgU0FOVEEgUk9TQSwgQ0EgOTU0MDUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAXU2ltcHNvbiBTaGVldCBNZXRhbCBJbmMPMjgzMyBEb3dkIERyaXZlClNBTlRBIFJPU0ECQ0EFOTU0MDVkAgoPFQQ%2FQnVzaW5lc3MgSG91cnM6IE5vcm1hbCBIb3VycyB3aXRoIEFmdGVyLWhvdXJzIEFuc3dlcmluZyBTZXJ2aWNlOjxicj5ZZWFycyBpbiBCdXNpbmVzczogT3ZlciAzMCB5ZWFycyBvZiBzZXJ2aW5nIGhvbWVvd25lcnMgaHR0cDovL3d3dy5zaW1wc29uc2hlZXRtZXRhbC5jb20gaHR0cDovL3d3dy5zaW1wc29uc2hlZXRtZXRhbC5jb21kAgsPFQYEOTY1ORdTaW1wc29uIFNoZWV0IE1ldGFsIEluYw8yODMzIERvd2QgRHJpdmUKU0FOVEEgUk9TQQJDQQU5NTQwNWQCDA8VAdgJPHAgY2xhc3M9ImRlYWxlci1iYWRnZXMgbWFyMCI%2BPGEgdGl0bGU9IkZhY3RvcnkgQXV0aG9yaXplZCIgIGRhdGEtZGVzYz0iIiBocmVmPSIvaG9tZWNvbWZvcnQvZW4vdXMvY2Fycmllci1leHBlcnRzLyMxIiB0YXJnZXQ9Il9zZWxmIiBjbGFzcz0idG9vbHRpcGNsYXNzIG1yMTAgIj48aW1nIHNyYz0iLy9maWxlcy5jYXJyaWVyLmNvbS9ob21lY29tZm9ydC9lbi91cy9jb250ZW50aW1hZ2VzL2ljbi1kZWFsLWZhZC5wbmciIGFsdD0iQmFkZ2UiPiA8L2ltZz48L2E%2BPGEgdGl0bGU9Ik5BVEUgVHJhaW5lZCIgIGRhdGEtZGVzYz0iIiBocmVmPSIvaG9tZWNvbWZvcnQvZW4vdXMvY2Fycmllci1leHBlcnRzLyMxIiB0YXJnZXQ9Il9zZWxmIiBjbGFzcz0idG9vbHRpcGNsYXNzIG1yMTAgIj48aW1nIHNyYz0iLy9maWxlcy5jYXJyaWVyLmNvbS9ob21lY29tZm9ydC9lbi91cy9jb250ZW50aW1hZ2VzL2ljbl9uYXRlX2xvZ28ucG5nIiBhbHQ9IkJhZGdlIj4gPC9pbWc%2BPC9hPjxhIHRpdGxlPSJGaW5hbmNpbmcgT2ZmZXJlZCIgIGRhdGEtZGVzYz0iIiBocmVmPSIvaG9tZWNvbWZvcnQvZW4vdXMvcmViYXRlcy1hbmQtZmluYW5jaW5nLyMxIiB0YXJnZXQ9Il9zZWxmIiBjbGFzcz0idG9vbHRpcGNsYXNzIG1yMTAgIj48aW1nIHNyYz0iLy9maWxlcy5jYXJyaWVyLmNvbS9ob21lY29tZm9ydC9lbi91cy9jb250ZW50aW1hZ2VzL2ZpbmFuY2luZy5wbmciIGFsdD0iQmFkZ2UiPiA8L2ltZz48L2E%2BPGEgdGl0bGU9IkNvb2wgQ2FzaCBQcm9tb3Rpb24iICBkYXRhLWRlc2M9IiIgaHJlZj0iL2hvbWVjb21mb3J0L2VuL3VzL3JlYmF0ZXMtYW5kLWZpbmFuY2luZy8jMCIgdGFyZ2V0PSJfc2VsZiIgY2xhc3M9InRvb2x0aXBjbGFzcyBtcjEwICI%2BPGltZyBzcmM9Ii8vZmlsZXMuY2Fycmllci5jb20vaG9tZWNvbWZvcnQvZW4vdXMvY29udGVudGltYWdlcy9pY24tZGVhbC1jb29sLnBuZyIgYWx0PSJCYWRnZSI%2BIDwvaW1nPjwvYT48YSB0aXRsZT0iRHVjdGxlc3MgU3BsaXQgU3lzdGVtcyIgIGRhdGEtZGVzYz0iIiBocmVmPSIvaG9tZWNvbWZvcnQvZW4vdXMvcHJvZHVjdHMvaGVhdGluZy1hbmQtY29vbGluZy9kdWN0bGVzcy1zeXN0ZW1zLyIgdGFyZ2V0PSJfc2VsZiIgY2xhc3M9InRvb2x0aXBjbGFzcyBtcjEwICI%2BPGltZyBzcmM9Ii8vZmlsZXMuY2Fycmllci5jb20vaG9tZWNvbWZvcnQvZW4vdXMvY29udGVudGltYWdlcy9pY24tZHVjdGZyZWVfbGcucG5nIiBhbHQ9IkJhZGdlIj4gPC9pbWc%2BPC9hPmQCAg9kFhZmDxUVATMWU2VhcnMgUm9lYnVjayAmYW1wOyBDbxEzMzMzIEJldmVybHkgUm9hZA9Ib2ZmbWFuIEVzdGF0ZXMCSUwFNjAxNzkMODc3LTgwNy03ODI5AAc0Mi4wNDI1ES04OC4wNzkzOTk5OTk5OTk4AjAzATMWU2VhcnMgUm9lYnVjayAmYW1wOyBDbxEzMzMzIEJldmVybHkgUm9hZA9Ib2ZmbWFuIEVzdGF0ZXMCSUwFNjAxNzkMODc3LTgwNy03ODI5AAc0Mi4wNDI1ES04OC4wNzkzOTk5OTk5OTk4ZAIBDxUGBTMyMjM5ElNlYXJzIFJvZWJ1Y2sgJiBDbxEzMzMzIEJldmVybHkgUm9hZA9Ib2ZmbWFuIEVzdGF0ZXMCSUzOATYwMTc5ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJyIC8%2BZAICDxUG7gEzMzMzIEJldmVybHkgUm9hZCBIb2ZmbWFuIEVzdGF0ZXMsIElMIDYwMTc5ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgFFNlYXJzIFJvZWJ1Y2sgJTI2IENvETMzMzMgQmV2ZXJseSBSb2FkD0hvZmZtYW4gRXN0YXRlcwJJTAU2MDE3OWQCAw8VBwAAAACQAjxwIGNsYXNzPSJkZWFsZXItYmFkZ2VzIG1hcjAiPjxhIHRpdGxlPSJDb29sIENhc2ggUHJvbW90aW9uIiAgZGF0YS1kZXNjPSIiIGhyZWY9Ii9ob21lY29tZm9ydC9lbi91cy9yZWJhdGVzLWFuZC1maW5hbmNpbmcvIzAiIHRhcmdldD0iX3NlbGYiIGNsYXNzPSJ0b29sdGlwY2xhc3MgbXIxMCAiPjxpbWcgc3JjPSIvL2ZpbGVzLmNhcnJpZXIuY29tL2hvbWVjb21mb3J0L2VuL3VzL2NvbnRlbnRpbWFnZXMvaWNuLWRlYWwtY29vbC5wbmciIGFsdD0iQmFkZ2UiPiA8L2ltZz48L2E%2BDDg3Ny04MDctNzgyOQw4NzctODA3LTc4MjlkAgQPFQYFMzIyMzkUU2VhcnMgUm9lYnVjayAlMjYgQ28RMzMzMyBCZXZlcmx5IFJvYWQPSG9mZm1hbiBFc3RhdGVzAklMBTYwMTc5ZAIFDxUVATMWU2VhcnMgUm9lYnVjayAmYW1wOyBDbxEzMzMzIEJldmVybHkgUm9hZA9Ib2ZmbWFuIEVzdGF0ZXMCSUwFNjAxNzkMODc3LTgwNy03ODI5AAc0Mi4wNDI1ES04OC4wNzkzOTk5OTk5OTk4ATMBMxZTZWFycyBSb2VidWNrICZhbXA7IENvETMzMzMgQmV2ZXJseSBSb2FkD0hvZmZtYW4gRXN0YXRlcwJJTAU2MDE3OQw4NzctODA3LTc4MjkABzQyLjA0MjURLTg4LjA3OTM5OTk5OTk5OThkAgYPFQgFMzIyMzkSU2VhcnMgUm9lYnVjayAmIENvE1Bob25lOiA4NzctODA3LTc4MjkTUGhvbmU6IDg3Ny04MDctNzgyOREzMzMzIEJldmVybHkgUm9hZA9Ib2ZmbWFuIEVzdGF0ZXMCSUzOATYwMTc5ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJyIC8%2BZAIHDxUG7gEzMzMzIEJldmVybHkgUm9hZCBIb2ZmbWFuIEVzdGF0ZXMsIElMIDYwMTc5ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgFFNlYXJzIFJvZWJ1Y2sgJTI2IENvETMzMzMgQmV2ZXJseSBSb2FkD0hvZmZtYW4gRXN0YXRlcwJJTAU2MDE3OWQCCA8VBAAAAABkAgkPFQYFMzIyMzkUU2VhcnMgUm9lYnVjayAlMjYgQ28RMzMzMyBCZXZlcmx5IFJvYWQPSG9mZm1hbiBFc3RhdGVzAklMBTYwMTc5ZAIKDxUBkAI8cCBjbGFzcz0iZGVhbGVyLWJhZGdlcyBtYXIwIj48YSB0aXRsZT0iQ29vbCBDYXNoIFByb21vdGlvbiIgIGRhdGEtZGVzYz0iIiBocmVmPSIvaG9tZWNvbWZvcnQvZW4vdXMvcmViYXRlcy1hbmQtZmluYW5jaW5nLyMwIiB0YXJnZXQ9Il9zZWxmIiBjbGFzcz0idG9vbHRpcGNsYXNzIG1yMTAgIj48aW1nIHNyYz0iLy9maWxlcy5jYXJyaWVyLmNvbS9ob21lY29tZm9ydC9lbi91cy9jb250ZW50aW1hZ2VzL2ljbi1kZWFsLWNvb2wucG5nIiBhbHQ9IkJhZGdlIj4gPC9pbWc%2BPC9hPmQYAQUeX19Db250cm9sc1JlcXVpcmVQb3N0QmFja0tleV9fFggFMWN0bDAwJHBhZ2VDb250ZW50JEZpbmRBRGVhbGVyJENoZWNrYm94TGlzdF9JdGVtJDAFMWN0bDAwJHBhZ2VDb250ZW50JEZpbmRBRGVhbGVyJENoZWNrYm94TGlzdF9JdGVtJDEFMWN0bDAwJHBhZ2VDb250ZW50JEZpbmRBRGVhbGVyJENoZWNrYm94TGlzdF9JdGVtJDIFMWN0bDAwJHBhZ2VDb250ZW50JEZpbmRBRGVhbGVyJENoZWNrYm94TGlzdF9JdGVtJDMFMWN0bDAwJHBhZ2VDb250ZW50JEZpbmRBRGVhbGVyJENoZWNrYm94TGlzdF9JdGVtJDQFMWN0bDAwJHBhZ2VDb250ZW50JEZpbmRBRGVhbGVyJENoZWNrYm94TGlzdF9JdGVtJDUFMWN0bDAwJHBhZ2VDb250ZW50JEZpbmRBRGVhbGVyJENoZWNrYm94TGlzdF9JdGVtJDYFMWN0bDAwJHBhZ2VDb250ZW50JEZpbmRBRGVhbGVyJENoZWNrYm94TGlzdF9JdGVtJDbvKF1LNKRTJcbmAYTt1MjhDYvqpg%3D%3D&__VIEWSTATEGENERATOR=D4769515&__PREVIOUSPAGE=hl3dsjUn86-nu0k61i-Qzubvwof4eTcETz-o5ACuoAt8hZbPVejNT_tyr4nfVHL_RuDMIaMQdbJvTEYfMVSMJzlxK91tmUP_s1VZPjzSQNt_z-wW4MnZ8SZ5b5COCOR8MdWHT5Fa-P--_F2fjYsYzDKNq5o1&__EVENTVALIDATION=%2FwEdABI8%2Bgv2Z8d2ndwcFIgSGicKCsURUQ9T1ZoOuBRqegaT2LiZH2ybr3OwUgpWNAhjsVfX0%2Fl9wtm%2Frqs01VifxMzMIRyUTmL4cy%2BOZZXuRSqPTFTnY778jpdvhTn3O3vIL3TnrzhFlTKOFc48%2B5KSSjpVRqBSp8IBYUHYULdCe6P5u20KfllC6x8lpmDQJP7qcdOq2f%2FQkYSn52obFg%2BYbcGe%2FLjdbmn4QEOA%2FdHUMNcD95yK6mTw234KiI2jYjjxZQ%2FdJIp2itlJoRQKKsBDN4bPvpaQCl0E8vMooECDP2hAddAgA7tUlbFJNAeeNfsQO03o2Zz6JnuGu2nfmyQwz5Cc9CzVNXN13T4tIx0d7iNHZzsJvvdutZHhwlpt3Bkjc2AfU%2FqhFJlJdWLvrfx5tlCglc3iwQ%3D%3D&hdnSearchKeyword=&hdnFacets=&hdnSearchType=&ctl00%24ctl00%24SearchBox1%24searchQuery=&ctl00%24ctl00%24SearchBox1%24btnSearch=&hdnSearchKeyword=&hdnFacets=&hdnSearchType=&ctl00%24ctl01%24MegaMenu1%24SearchBox1%24searchQueryMobile=&ctl00%24pageContent%24FindADealer%24dealerLocator=94928&ctl00%24pageContent%24FindADealer%24dropdownlist_Item=Featured+Dealers&ctl00%24pageContent%24FindADealer%24HiddenField1=&recipientEmail=&first_name_txt=&last_name_txt=&mobile_txt=";

//ord=&hdnFacets=&hdnSearchType=&ctl00%24ctl01%24MegaMenu1%24SearchBox1%24searchQueryMobile=&ctl00%24pageContent%24FindADealer%24dealerLocator=".$zip."&c
			$webRequests[] = new WebRequest($url,$type,"POST",$postData);
        

      }
		$this->loadWebRequests($webRequests);
   }
/*
   static $hostCount=array();
   static function loadCallBack($url,$html,$arg3)
   {
      if (empty($url)) //timeout?
         return;

      $thiz = self::getInstance();
      if (strpos($html,"The Three Laws of Robotics are as follows:"))
      {
         $host = parse_url($url,PHP_URL_HOST);
         log::info("ERROR! ERROR! FORBIDDEN ACCESS!");
               
         $html=null;
      }

      if (strlen($html)<5000)
      {$html=null;}
      baseScrape::loadCallBack($url,$html,$arg3);
   }*/


   public static function parse($url,$html)
   {
      $type = get_class();    
      $thiz = self::getInstance();

      $ap = new Address_Parser();
      $pp = new phone_parser();
      $ep = new Email_Parser();
      $kvp = new KeyValue_Parser(); 
      $urls = array();
      log::info($url);
      //parse_str(parse_url($url,PHP_URL_QUERY),$query); 

   // file_put_contents("$type.html",$html); 
      $webRequests = array();
      $links = array();
      $data = array();

		$xTop =  new  XPath($html);	
		foreach($xTop->query("//div[contains(@id='details')]") as $nodeTop)
		{
			$x = new Xpath($nodeTop);

			foreach($x->query("//h2") as $node)
			{
				$data['COMPANY'] =  self::cleanup($node->textContent);
			}

			foreach($x->query("//p[@class='address']") as $node)
			{
				$data = array_merge($data,$ap->parse($node->textContent));
			}

			$data = array_merge($data,$pp->parse($nodeTop->textContent));
			$data = array_merge($data,$ep->parse($nodeTop->textContent));

			$data['COUNTRY'] = 'United States';
			$data['SOURCE_URL'] = $url;
			log::info(db::normalize($data));
			db::store($type,$data,array('SOURCE_URL')); 
		}	
   }
}

$r= new carrier();
$r->parseCommandLine();

